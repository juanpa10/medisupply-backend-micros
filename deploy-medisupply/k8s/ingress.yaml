# --- Middlewares: quitan los prefijos /auth y /roles ---
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: strip-auth
  namespace: medisupply
spec:
  stripPrefix:
    prefixes: ["/auth"]
---
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: strip-roles
  namespace: medisupply
spec:
  stripPrefix:
    prefixes: ["/roles"]
---
# --- IngressRoute (entryPoint "web" = :80) ---
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: medisupply-ingressroute
  namespace: medisupply
spec:
  entryPoints:
    - web
  routes:
    - kind: Rule
      match: Host(`api.medisupply.local`) && PathPrefix(`/auth`)
      middlewares:
        - name: strip-auth
      services:
        - name: auth-service   # EXISTE
          port: 9001
    - kind: Rule
      match: Host(`api.medisupply.local`) && PathPrefix(`/roles`)
      middlewares:
        - name: strip-roles
      services:
        - name: roles-api      # EXISTE
          port: 9003
